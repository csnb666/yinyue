<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æç®€éŸ³ä¹å·¥å…·ï¼ˆç¨³å®šç‰ˆï¼‰</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #fafafa; padding: 30px 15px; color: #111; }
        .container { 
            max-width: 550px; margin: 0 auto; background: #fff; 
            padding: 40px 25px; border: 1px solid #eee; border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .time { 
            text-align: center; font-size: 17px; color: #666; 
            padding-bottom: 18px; margin-bottom: 25px;
            border-bottom: 1px solid #eee;
        }
        
        .btn { 
            width: 100%; padding: 16px; margin: 10px 0; border: none; 
            border-radius: 3px; font-size: 15px; cursor: pointer; 
            transition: all 0.25s ease;
        }
        .btn.primary { background: #111; color: #fff; }
        .btn.primary:hover { background: #333; transform: translateY(-1px); }
        .btn.secondary { background: #fff; color: #111; border: 1px solid #ddd; }
        .btn.secondary:hover { border-color: #111; background: #f9f9f9; }
        .btn.file-btn { padding: 8px 12px; width: auto; margin-top: 8px; }
        
        /* åŠ è½½æç¤º */
        .loading-box {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #fff; padding: 22px 35px; border-radius: 4px;
            box-shadow: 0 3px 12px rgba(0,0,0,0.1); z-index: 101; display: none;
            text-align: center;
        }
        .loading-spinner {
            width: 24px; height: 24px; margin: 0 auto 12px;
            border: 2px solid #eee; border-top-color: #111; border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { font-size: 15px; color: #333; }
        
        /* å¼¹çª—æ ·å¼ */
        .prompt-box, .choice-box, .link-prompt-box, .file-path-prompt-box { 
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            background: #fff; padding: 22px; border-radius: 4px;
            box-shadow: 0 3px 12px rgba(0,0,0,0.1); z-index: 100; display: none; 
            min-width: 280px;
        }
        .prompt-box h3, .choice-box h3, .link-prompt-box h3, .file-path-prompt-box h3 { 
            font-size: 16px; color: #111; margin-bottom: 18px;
            padding-bottom: 8px; border-bottom: 1px solid #eee;
        }
        
        .input-group { margin: 18px 0; }
        .input-group label { 
            display: block; margin-bottom: 7px; color: #444; 
            font-size: 14px;
        }
        .input-group input { 
            width: 100%; padding: 13px; border: 1px solid #ddd; 
            border-radius: 3px; font-size: 14px;
            transition: border 0.2s;
        }
        .input-group input:focus { 
            outline: none; border-color: #111;
        }
        
        /* æç¤ºæ¡† */
        .toast { 
            position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%); 
            background: rgba(0,0,0,0.85); color: #fff; padding: 13px 22px; 
            border-radius: 20px; font-size: 14px; z-index: 99; display: none; 
        }
        
        .overlay, .link-overlay, .file-path-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.4); z-index: 98; display: none; 
        }
        
        .choice-scroll { 
            max-height: 280px; overflow-y: auto; padding-right: 8px; 
            margin-top: 12px;
        }
        .choice-scroll::-webkit-scrollbar { width: 5px; }
        .choice-scroll::-webkit-scrollbar-thumb { 
            background: #999; border-radius: 3px;
        }
        .choice-scroll::-webkit-scrollbar-track { background: #f5f5f5; }
        
        #audioPlayer { 
            width: 100%; margin-top: 15px; border: 1px solid #eee; 
            border-radius: 3px;
        }
        #fileInput { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="time" id="currentTime"></div>
        <button class="btn primary" id="mainBtn">æ‰“å¼€éŸ³ä¹å·¥å…·</button>
        <audio id="audioPlayer" controls style="display:none;"></audio>
    </div>
    <!-- åŸæœ‰å¼¹çª—ï¼šæœç´¢è¾“å…¥ã€æ­Œæ›²é€‰æ‹© -->
    <div class="overlay" id="promptOverlay"></div>
    <div class="prompt-box" id="promptBox">
        <h3 id="promptTitle">æœç´¢æ­Œæ›²</h3>
        <div class="input-group">
            <label for="songName">æ­Œæ›²åï¼ˆå¯åŠ æ­Œæ‰‹ï¼‰</label>
            <input type="text" id="songName" placeholder="ä¾‹å¦‚ï¼šæ™´å¤© å‘¨æ°ä¼¦" required>
        </div>
        <div class="input-group">
            <label for="showCount">æ˜¾ç¤ºæ•°é‡ï¼ˆ1-100ï¼‰</label>
            <input type="number" id="showCount" value="10" min="1" max="100" required>
        </div>
        <button class="btn primary" id="promptConfirm">ç¡®è®¤æœç´¢</button>
        <button class="btn secondary" id="promptCancel">å–æ¶ˆ</button>
    </div>
    <div class="overlay" id="choiceOverlay"></div>
    <div class="choice-box" id="choiceBox">
        <h3 id="choiceTitle">è¯·é€‰æ‹©æ“ä½œ</h3>
        <div class="choice-scroll" id="choiceScroll">
            <div id="choiceList"></div>
        </div>
    </div>
    <!-- æ–°å¢å¼¹çª—1ï¼šè¾“å…¥ç›´é“¾æ’­æ”¾ï¼ˆæ— é™åˆ¶ï¼‰ -->
    <div class="link-overlay" id="linkOverlay"></div>
    <div class="link-prompt-box" id="linkPromptBox">
        <h3 id="linkPromptTitle">è¾“å…¥éŸ³ä¹ç›´é“¾æ’­æ”¾</h3>
        <div class="input-group">
            <label for="musicLink">éŸ³ä¹ç›´é“¾</label>
            <input type="text" id="musicLink" placeholder="è¾“å…¥ä»»æ„éŸ³ä¹ç›´é“¾" required>
        </div>
        <button class="btn primary" id="linkConfirm">ç¡®è®¤æ’­æ”¾</button>
        <button class="btn secondary" id="linkCancel">å–æ¶ˆ</button>
    </div>
    <!-- æ–°å¢å¼¹çª—2ï¼šæœ¬åœ°æ–‡ä»¶æ’­æ”¾ï¼ˆæ— é™åˆ¶ï¼‰ -->
    <div class="file-path-overlay" id="filePathOverlay"></div>
    <div class="file-path-prompt-box" id="filePathPromptBox">
        <h3 id="filePathPromptTitle">æœ¬åœ°æ–‡ä»¶æ’­æ”¾</h3>
        <div class="input-group">
            <label for="filePath">æ–‡ä»¶è·¯å¾„</label>
            <input type="text" id="filePath" placeholder="è¾“å…¥æ–‡ä»¶è·¯å¾„" required>
        </div>
        <div class="input-group">
            <label>æˆ–é€‰æ‹©æœ¬åœ°æ–‡ä»¶</label>
            <button class="btn secondary file-btn" id="selectFileBtn">é€‰æ‹©æ–‡ä»¶</button>
            <input type="file" id="fileInput">
        </div>
        <button class="btn primary" id="filePathConfirm">ç¡®è®¤æ’­æ”¾</button>
        <button class="btn secondary" id="filePathCancel">å–æ¶ˆ</button>
    </div>
    <!-- åŠ è½½æç¤ºæ¡† -->
    <div class="loading-box" id="loadingBox">
        <div class="loading-spinner"></div>
        <div class="loading-text">æ­£åœ¨åŠ è½½...</div>
    </div>
    <!-- æç¤ºæ¡† -->
    <div class="toast" id="toast"></div>
    <script>
        // 1. åŸºç¡€å·¥å…·å‡½æ•°ï¼šé‡ç‚¹å¼ºåŒ–å¤åˆ¶åŠŸèƒ½çš„å…¼å®¹æ€§
        const util = {
            getCurrentTime() {
                const date = new Date();
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const hour = String(date.getHours()).padStart(2, '0');
                const minute = String(date.getMinutes()).padStart(2, '0');
                const second = String(date.getSeconds()).padStart(2, '0');
                return `${year}å¹´${month}æœˆ${day}æ—¥ ${hour}:${minute}:${second}`;
            },
            getRandomEmoji() {
                const bqt = ["ğŸŒ ","ğŸ‹","ğŸ¥","ğŸ¡","ğŸ‹","ğŸ€","ğŸ”°","ğŸ™ƒ","ğŸ’®","ğŸ¡","ğŸ’ ","ğŸï¸","ğŸŒ€"];
                return bqt[Math.floor(Math.random() * bqt.length)];
            },
            toast(msg, duration = 3000) {
                const toastEl = document.getElementById('toast');
                toastEl.textContent = msg;
                toastEl.style.display = 'block';
                setTimeout(() => toastEl.style.display = 'none', duration);
            },
            // å¼ºåˆ¶ä½¿ç”¨é™çº§æ–¹æ¡ˆï¼ˆéšè—æ–‡æœ¬æ¡†+execCommandï¼‰ç¡®ä¿å¤åˆ¶æˆåŠŸ
            copyToClipboard: function(text, successMsg = 'å¤åˆ¶æˆåŠŸ', failMsg = 'å¤åˆ¶å¤±è´¥') {
                try {
                    const textarea = document.createElement('textarea');
                    textarea.value = text;
                    textarea.style.position = 'fixed';
                    textarea.style.top = '-9999px';
                    textarea.style.left = '-9999px';
                    document.body.appendChild(textarea);
                    textarea.select();
                    const result = document.execCommand('copy');
                    document.body.removeChild(textarea);
                    if (result) {
                        this.toast(successMsg);
                    } else {
                        this.toast(failMsg);
                        console.error('å¤åˆ¶å¤±è´¥ï¼ˆexecCommandè¿”å›falseï¼‰');
                    }
                } catch (err) {
                    this.toast(failMsg);
                    console.error('å¤åˆ¶å¼‚å¸¸ï¼š', err);
                }
            },
            showLoading() {
                document.getElementById('loadingBox').style.display = 'block';
            },
            hideLoading() {
                document.getElementById('loadingBox').style.display = 'none';
            },
            showChoiceWithControl(title, list, callback) {
                const choiceTitle = document.getElementById('choiceTitle');
                const choiceList = document.getElementById('choiceList');
                const choiceOverlay = document.getElementById('choiceOverlay');
                const choiceBox = document.getElementById('choiceBox');
                
                choiceList.innerHTML = '';
                choiceOverlay.onclick = null;
                
                choiceTitle.textContent = title;
                
                list.forEach((item, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'btn secondary';
                    btn.textContent = item;
                    btn.onclick = () => {
                        callback(index + 1);
                        if (index === 0) {
                            choiceOverlay.style.display = 'none';
                            choiceBox.style.display = 'none';
                        }
                    };
                    choiceList.appendChild(btn);
                });
                
                choiceOverlay.onclick = () => {
                    choiceOverlay.style.display = 'none';
                    choiceBox.style.display = 'none';
                };
                
                choiceOverlay.style.display = 'block';
                choiceBox.style.display = 'block';
            },
            showChoice(title, list) {
                return new Promise((resolve) => {
                    const choiceTitle = document.getElementById('choiceTitle');
                    const choiceList = document.getElementById('choiceList');
                    const choiceOverlay = document.getElementById('choiceOverlay');
                    const choiceBox = document.getElementById('choiceBox');
                    choiceTitle.textContent = title;
                    choiceList.innerHTML = '';
                    list.forEach((item, index) => {
                        const btn = document.createElement('button');
                        btn.className = 'btn secondary';
                        btn.textContent = item;
                        btn.onclick = () => {
                            choiceOverlay.style.display = 'none';
                            choiceBox.style.display = 'none';
                            resolve(index + 1);
                        };
                        choiceList.appendChild(btn);
                    });
                    choiceOverlay.style.display = 'block';
                    choiceOverlay.onclick = () => {
                        choiceOverlay.style.display = 'none';
                        choiceBox.style.display = 'none';
                        resolve(null);
                    };
                    choiceBox.style.display = 'block';
                });
            },
            showPrompt(title, defaultVal = ['', '10']) {
                return new Promise((resolve) => {
                    const promptTitle = document.getElementById('promptTitle');
                    const songNameInput = document.getElementById('songName');
                    const showCountInput = document.getElementById('showCount');
                    const promptOverlay = document.getElementById('promptOverlay');
                    const promptBox = document.getElementById('promptBox');
                    const confirmBtn = document.getElementById('promptConfirm');
                    const cancelBtn = document.getElementById('promptCancel');
                    
                    confirmBtn.removeEventListener('click', () => {});
                    cancelBtn.removeEventListener('click', () => {});
                    
                    promptTitle.textContent = title;
                    songNameInput.value = defaultVal[0] || '';
                    showCountInput.value = defaultVal[1] || '10';
                    const confirmHandler = () => {
                        const songName = songNameInput.value.trim();
                        const showCount = showCountInput.value.trim();
                        if (!songName) { this.toast('è¯·è¾“å…¥æ­Œæ›²å'); return; }
                        if (isNaN(showCount) || showCount < 1 || showCount > 100) { this.toast('æ˜¾ç¤ºæ•°é‡éœ€ä¸º1-100çš„æ•´æ•°'); return; }
                        promptOverlay.style.display = 'none';
                        promptBox.style.display = 'none';
                        resolve([songName, showCount]);
                    };
                    const cancelHandler = () => {
                        promptOverlay.style.display = 'none';
                        promptBox.style.display = 'none';
                        resolve(null);
                    };
                    confirmBtn.addEventListener('click', confirmHandler);
                    cancelBtn.addEventListener('click', cancelHandler);
                    promptOverlay.style.display = 'block';
                    promptOverlay.onclick = cancelHandler;
                    promptBox.style.display = 'block';
                });
            },
            showLinkPrompt() {
                return new Promise((resolve) => {
                    const linkOverlay = document.getElementById('linkOverlay');
                    const linkPromptBox = document.getElementById('linkPromptBox');
                    const linkConfirm = document.getElementById('linkConfirm');
                    const linkCancel = document.getElementById('linkCancel');
                    const musicLinkInput = document.getElementById('musicLink');
                    
                    linkConfirm.removeEventListener('click', () => {});
                    linkCancel.removeEventListener('click', () => {});
                    
                    const confirmHandler = () => {
                        const link = musicLinkInput.value.trim();
                        if (!link) { this.toast('è¯·è¾“å…¥ç›´é“¾'); return; }
                        linkOverlay.style.display = 'none';
                        linkPromptBox.style.display = 'none';
                        resolve(link);
                    };
                    const cancelHandler = () => {
                        linkOverlay.style.display = 'none';
                        linkPromptBox.style.display = 'none';
                        resolve(null);
                    };
                    musicLinkInput.value = '';
                    linkConfirm.addEventListener('click', confirmHandler);
                    linkCancel.addEventListener('click', cancelHandler);
                    linkOverlay.style.display = 'block';
                    linkOverlay.onclick = cancelHandler;
                    linkPromptBox.style.display = 'block';
                });
            },
            showFilePathPrompt() {
                return new Promise((resolve) => {
                    const filePathOverlay = document.getElementById('filePathOverlay');
                    const filePathPromptBox = document.getElementById('filePathPromptBox');
                    const filePathConfirm = document.getElementById('filePathConfirm');
                    const filePathCancel = document.getElementById('filePathCancel');
                    const selectFileBtn = document.getElementById('selectFileBtn');
                    const fileInput = document.getElementById('fileInput');
                    const filePathInput = document.getElementById('filePath');
                    
                    filePathConfirm.removeEventListener('click', () => {});
                    filePathCancel.removeEventListener('click', () => {});
                    selectFileBtn.onclick = null;
                    fileInput.onchange = null;
                    
                    selectFileBtn.onclick = () => fileInput.click();
                    fileInput.onchange = (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            resolve(file); 
                            filePathOverlay.style.display = 'none';
                            filePathPromptBox.style.display = 'none';
                            fileInput.value = '';
                        }
                    };
                    const confirmHandler = () => {
                        const path = filePathInput.value.trim();
                        if (!path) { this.toast('è¯·è¾“å…¥æ–‡ä»¶è·¯å¾„'); return; }
                        filePathOverlay.style.display = 'none';
                        filePathPromptBox.style.display = 'none';
                        resolve({ type: 'path', value: path });
                    };
                    const cancelHandler = () => {
                        filePathOverlay.style.display = 'none';
                        filePathPromptBox.style.display = 'none';
                        resolve(null);
                        fileInput.value = '';
                    };
                    filePathInput.value = '';
                    filePathConfirm.addEventListener('click', confirmHandler);
                    filePathCancel.addEventListener('click', cancelHandler);
                    filePathOverlay.style.display = 'block';
                    filePathOverlay.onclick = cancelHandler;
                    filePathPromptBox.style.display = 'block';
                });
            },
            storage: {
                get(key) {
                    const val = localStorage.getItem(key);
                    return val ? JSON.parse(val) : null;
                },
                set(key, val) {
                    localStorage.setItem(key, JSON.stringify(val));
                }
            }
        };
        // 2. éŸ³ä¹æ ¸å¿ƒåŠŸèƒ½ï¼šç¡®ä¿æ‰€æœ‰å˜é‡ä½œç”¨åŸŸæ˜ç¡®
        const music = {
            state: {
                sel: null,
                gqlb: ["è¯·å…ˆæœç´¢æ­Œæ›²"],
                idb: ["1010"],
                configKey: "musicToolConfig",
                currentAudioUrl: "",
                downloadPath: "/storage/emulated/0/AndroLua/Download/obj/wo3DlMOGwrbDjj7DisKw/",
                tempFileUrl: "",
                proxyUrl: "https://api.codetabs.com/v1/proxy/?quest="
            },
            init() {
                this.state.sel = util.storage.get(this.state.configKey) || ["", "10"];
                window.onbeforeunload = () => {
                    if (this.state.tempFileUrl) URL.revokeObjectURL(this.state.tempFileUrl);
                };
            },
            async searchSong(name, limit) {
                try {
                    const originUrl = `http://music.163.com/api/search/get?s=${encodeURIComponent(name)}&type=1&offset=0&total=true&limit=${limit}`;
                    const proxyRequestUrl = this.state.proxyUrl + encodeURIComponent(originUrl);
                    
                    const res = await fetch(proxyRequestUrl);
                    if (!res.ok) throw new Error(`çŠ¶æ€ç ï¼š${res.status}`);
                    return await res.json();
                } catch (err) {
                    util.toast(`æœç´¢å¤±è´¥ï¼š${err.message}`);
                    return null;
                }
            },
            parseSongData(jsonData, searchName, limit) {
                if (!jsonData || !jsonData.result) return false;
                const songCount = jsonData.result.songCount || 0;
                const showCount = songCount < limit ? songCount : limit;
                this.state.gqlb = [];
                this.state.idb = [];
                for (let i = 0; i < showCount; i++) {
                    const song = jsonData.result.songs[i];
                    const singer = song.artists[0].name;
                    const duration = Math.floor(song.duration / 1000);
                    const timeStr = `${Math.floor(duration / 60)}:${String(duration % 60).padStart(2, '0')}`;
                    this.state.gqlb.push(`${song.name} - ${singer}ï¼ˆ${timeStr}ï¼‰`);
                    this.state.idb.push(song.id);
                }
                return `æ‰¾åˆ°ã€Š${searchName}ã€‹ç›¸å…³æ­Œæ›²${songCount}é¦–ï¼ˆæ˜¾ç¤ºå‰${showCount}é¦–ï¼‰`;
            },
            playSong(id, name) {
                this.stopSong();
                this.state.currentAudioUrl = `https://music.163.com/song/media/outer/url?id=${id}.mp3`;
                const audio = document.getElementById('audioPlayer');
                audio.src = this.state.currentAudioUrl;
                audio.style.display = 'block';
                audio.play().then(() => util.toast(`æ­£åœ¨æ’­æ”¾ï¼š${name}`))
                    .catch(err => util.toast(`æ’­æ”¾å¤±è´¥ï¼š${err.message}`));
            },
            async playByLink(link) {
                this.stopSong();
                util.showLoading();
                const audio = document.getElementById('audioPlayer');
                try {
                    this.state.currentAudioUrl = link;
                    audio.src = link;
                    audio.style.display = 'block';
                    await audio.play();
                    util.toast('ç›´é“¾æ’­æ”¾ä¸­');
                } catch (err) {
                    util.toast(`æ’­æ”¾å¤±è´¥ï¼š${err.message}`);
                } finally {
                    util.hideLoading();
                }
            },
            playByFile(fileInfo) {
                this.stopSong();
                const audio = document.getElementById('audioPlayer');
                if (this.state.tempFileUrl) {
                    URL.revokeObjectURL(this.state.tempFileUrl);
                    this.state.tempFileUrl = "";
                }
                if (fileInfo instanceof File) {
                    this.state.tempFileUrl = URL.createObjectURL(fileInfo);
                    audio.src = this.state.tempFileUrl;
                    audio.style.display = 'block';
                    audio.play().then(() => util.toast(`æ­£åœ¨æ’­æ”¾æ–‡ä»¶ï¼š${fileInfo.name}`))
                        .catch(err => util.toast(`æ–‡ä»¶æ’­æ”¾å¤±è´¥ï¼š${err.message}`));
                } else if (fileInfo?.type === 'path') {
                    audio.src = fileInfo.value;
                    audio.style.display = 'block';
                    audio.play().then(() => util.toast(`æŒ‰è·¯å¾„æ’­æ”¾ä¸­`))
                        .catch(err => util.toast(`è·¯å¾„æ’­æ”¾å¤±è´¥ï¼š${err.message}`));
                }
            },
            stopSong() {
                const audio = document.getElementById('audioPlayer');
                audio.pause();
                audio.src = '';
                this.state.currentAudioUrl = "";
                if (this.state.tempFileUrl) {
                    URL.revokeObjectURL(this.state.tempFileUrl);
                    this.state.tempFileUrl = "";
                }
                audio.style.display = 'none';
                util.toast('å·²åœæ­¢æ’­æ”¾');
            },
            async playHotSong() {
                util.showLoading();
                try {
                    const res = await fetch('https://api.uomg.com/api/rand.music?sort=çƒ­æ­Œæ¦œ&format=json');
                    if (!res.ok) throw new Error('è·å–çƒ­æ­Œå¤±è´¥');
                    const data = await res.json();
                    if (!data.data || !data.data.url) throw new Error('çƒ­æ­Œé“¾æ¥æ— æ•ˆ');
                    this.stopSong();
                    this.state.currentAudioUrl = data.data.url;
                    const audio = document.getElementById('audioPlayer');
                    audio.src = data.data.url;
                    audio.style.display = 'block';
                    await audio.play();
                    util.toast(`çƒ­æ­Œæ¨èï¼š${data.data.name} - ${data.data.singer}`);
                } catch (err) {
                    util.toast(`çƒ­æ­Œæ’­æ”¾å¤±è´¥ï¼š${err.message}`);
                } finally {
                    util.hideLoading();
                }
            },
            async selectAndPlay() {
                if (this.state.gqlb.length === 0 || this.state.gqlb[0] === "è¯·å…ˆæœç´¢æ­Œæ›²") {
                    util.toast('è¯·å…ˆæœç´¢æ­Œæ›²');
                    return;
                }
                const songIndex = await util.showChoice('é€‰æ‹©æ­Œæ›²', this.state.gqlb);
                if (!songIndex) return;
                
                const selectedSong = this.state.gqlb[songIndex - 1];
                const selectedSongId = this.state.idb[songIndex - 1];
                const songUrl = `https://music.163.com/song/media/outer/url?id=${selectedSongId}.mp3`;
                const downloadPath = this.state.downloadPath;
                const _this = this;
                
                util.showChoiceWithControl(`æ“ä½œï¼š${selectedSong}`, [
                    '1. æ’­æ”¾æ­Œæ›²',
                    '2. å¤åˆ¶éŸ³ä¹ç›´é“¾',
                    '3. å¤åˆ¶ä¸‹è½½ä¿å­˜è·¯å¾„'
                ], function(actionIndex) {
                    switch (actionIndex) {
                        case 1:
                            _this.playSong(selectedSongId, selectedSong);
                            break;
                        case 2:
                            util.copyToClipboard(songUrl, 'éŸ³ä¹ç›´é“¾å¤åˆ¶æˆåŠŸ', 'éŸ³ä¹ç›´é“¾å¤åˆ¶å¤±è´¥');
                            break;
                        case 3:
                            util.copyToClipboard(downloadPath, 'ä¸‹è½½è·¯å¾„å¤åˆ¶æˆåŠŸ', 'ä¸‹è½½è·¯å¾„å¤åˆ¶å¤±è´¥');
                            break;
                    }
                });
            },
            async searchAndShow() {
                const input = await util.showPrompt('æœç´¢æ­Œæ›²', this.state.sel);
                if (!input) return;
                const [searchName, showCount] = input;
                util.storage.set(this.state.configKey, [searchName, showCount]);
                this.state.sel = [searchName, showCount];
                util.showLoading();
                const songData = await this.searchSong(searchName, showCount);
                util.hideLoading();
                if (!songData) return;
                const title = this.parseSongData(songData, searchName, showCount);
                if (title) await this.selectAndPlay();
            }
        };
        // 3. ä¸»åº”ç”¨é€»è¾‘
        const app = {
            async mainMenu() {
                const emoji = util.getRandomEmoji();
                const menuTitle = `${emoji} æç®€éŸ³ä¹å·¥å…· ${emoji}`;
                const choice = await util.showChoice(menuTitle, [
                    "1. æœç´¢æ­Œæ›²",
                    "2. é€‰æ‹©å·²æœæ­Œæ›²",
                    "3. æ’­æ”¾çƒ­æ­Œ",
                    "4. åœæ­¢æ’­æ”¾",
                    "5. è¾“å…¥ç›´é“¾æ’­æ”¾",
                    "6. æœ¬åœ°æ–‡ä»¶æ’­æ”¾",
                    "7. åˆ·æ–°èœå•"
                ]);
                switch (choice) {
                    case 1:
                        await music.searchAndShow();
                        break;
                    case 2:
                        await music.selectAndPlay();
                        break;
                    case 3:
                        await music.playHotSong();
                        break;
                    case 4:
                        music.stopSong();
                        break;
                    case 5:
                        const link = await util.showLinkPrompt();
                        if (link) await music.playByLink(link);
                        break;
                    case 6:
                        const fileInfo = await util.showFilePathPrompt();
                        if (fileInfo) music.playByFile(fileInfo);
                        break;
                    case 7:
                        await this.mainMenu();
                        break;
                }
            },
            init() {
                music.init();
                const updateTime = () => {
                    document.getElementById('currentTime').textContent = util.getCurrentTime();
                };
                updateTime();
                setInterval(updateTime, 1000);
                document.getElementById('mainBtn').addEventListener('click', async () => {
                    await this.mainMenu();
                });
            }
        };
        window.onload = () => {
            app.init();
        };
    </script>
</body>
</html>
